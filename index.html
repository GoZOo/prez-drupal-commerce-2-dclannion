<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Drupal Commerce 2.x - Toutes les cartes pour un commerce métier - Fabien Clément</title>

    <link rel="shortcut icon" href="lib/image/favicon.ico" />
		<meta name="description" content="Drupal Commerce 2.x - Toutes les cartes pour un commerce métier.">
		<meta name="author" content="Fabien Clément">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">
		<link rel="stylesheet" href="css/theme/dclannion2017.css">
		<link rel="stylesheet" href="css/theme/personal.css">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">
        <footer>
            <div class="branding--logo">
                <a class="logo__image__lequipetech" href="http://www.lequipe.tech">L'équipe.tech</a>
                <span class="logo__image"><img src="lib/image/logo-seul.png" alt="DrupalCamp Lannion 2017" height="55px"></span>
                <p class="logo__site-name">#dclannion</p>
            </div>
            <div class="session--info">
                <p class="session__title">Drupal Commerce 2.x<span class="seperator">&nbsp;/&nbsp;</span></p>
                <p class="session__presenter">Fabien Clément @GozOo</p>
            </div>
        </footer>
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section class="dclannion2017-intro" data-background="lib/image/background.jpg">
					<h1>Drupal Commerce 2.x - Toutes les cartes pour un commerce métier.</h1>
					<h2>Fabien Clément - @GozOo</h2>
                    <p class="function">
                        <small>Dir. Tech <a href="https://twitter.com/lequipetech">@lequipetech</a></small>
                    </p>
				</section>

                <section>
                    <section>
                        <h2>Drupal &amp; Commerce</h2>
                    </section>
                    <section>
                        <h2>A l'origine...</h2>
                        <p>
                            2007: Drupal 5 puis 6 et Ubercart.
                        </p>
                        <p>
                            2010: Drupal 7, Réécriture complète, création du module Commerce porté majoritairement par les Commerce Guys, société créée pour l’occasion.
                        </p>
                    </section>
                    <section>
                        <h2>Drupal 7 &amp; commerce</h2>
                        <p>
                            Commerce premier à utiliser au maximum les nouvelles fonctionnalités de Drupal 7 (entités, bundles etc) et contribue à l’amélioration du core.
                        </p>
                    </section>
                    <section>
                        <h2>Aujourd'hui</h2>
                        <p>
                            Commerce 2.x, réécriture pour Drupal 8
                        </p>
                    </section>
                    <section>
                        <h2>Drupal 8 &amp; Commerce 2.x</h2>
                        <p>
                            Toujours une référence pour suivre les bonnes pratiques de développement.
                        </p>
                        <p>
                            Toujours contributeur au core Drupal 8.
                        </p>
                    </section>
                </section>

                <!-- Example of nested vertical slides -->
                <section>
                    <section>
                        <h2>Sous le capot de Commerce 2.x</h2>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Librairies PHP</h2>
                    </section>
                    <section>
                        <h2>Création de librairies PHP utilisables et utilisées par la communauté PHP</h2>
                        <ul>
                            <li class="fragment"><strong style="color: #fcc500;">commerceguys/intl</strong>: Librairie d’internationalisation produite par les données CLDR. Gère les devises, leur format et bien plus.</li>
                            <li class="fragment"><strong style="color: #fcc500;">commerceguys/addressing</strong>: Librairie de gestion des adresse, basée sur les données Google. Gère le stockage et la manipulation des adresses postales.</li>
                        </ul>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>(Ab)use des entités</h2>
                        <div class="box fragment" style="width: 40%;display: inline-block; vertical-align: top;margin: 1em;">
                            <div class="box-content" style="font-size: 0.8em;">
                                <ul>
                                    <li>Store</li>
                                    <li>Product</li>
                                    <li>Product variation</li>
                                    <li>Order</li>
                                    <li>Order Item</li>
                                </ul>
                            </div>
                        </div>
                        <div class="box fragment" style="width: 40%;display: inline-block; vertical-align: top;margin: 1em;">
                            <div class="box-content" style="font-size: 0.8em;">
                                <ul>
                                    <li>Workflow</li>
                                    <li>Checkout</li>
                                    <li>Payment</li>
                                    <li>Price</li>
                                    <li>Etc.</li>
                                </ul>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h2>Mais aussi des plugins</h2>
                        <div class="box fragment" style="width: 40%;display: inline-block; vertical-align: top;margin: 1em;">
                            <div class="box-content" style="font-size: 0.8em;">
                                <ul>
                                    <li>Promotion</li>
                                    <li>Coupon</li>
                                    <li>CheckoutPane</li>
                                    <li>PaymentGateway</li>
                                </ul>
                            </div>
                        </div>
                        <div class="box fragment" style="width: 40%;display: inline-block; vertical-align: top;margin: 1em;">
                            <div class="box-content" style="font-size: 0.8em;">
                                <ul>
                                    <li>States</li>
                                    <li>TaxType</li>
                                    <li>Etc.</li>
                                </ul>
                            </div>
                        </div>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Commerce Out of the Box</h2>
                        <p>... NON</p>
                        <ul>
                            <li>Configuration obligatoire pour démarrer son commerce simple (ex vendre des t-shirts)</li>
                            <li>Créer une boutique</li>
                            <li>Ajouter une devise</li>
                            <li>Définir ses types de produits</li>
                            <li>Gérer les affichages de produits, listing, ajout au panier</li>
                            <li>Parcours d’achat</li>
                            <li>Paiement</li>
                            <li>Pas de thème par défaut</li>
                            <li>etc.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Commerce métier</h2>
                        <p>Qui dit métier, dit développement spécifique.</p>
                        <p>Terrain de prédilection de Commerce 2.x.</p>
                        <p>Quasiment tout peut être étendu, modifié, ajouter ses plugins, réagir à des événements, processors etc.</p>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Cas pratiques</h2>
                    </section>
                    <section>
                        <h2>Affichages différents d'un même formulaire</h2>
                        <p class="fragment" style="color: #fcc500;">
                            <i>Exemple: Un affichage de formulaire spécifique pour  les entreprises, un autre affichage pour les particuliers.</i>
                        </p>
                        <p class="fragment">
                            Drupal 8 implémente les <strong>form view display</strong>.
                        </p>
                        <p class="fragment">
                            Plusieurs affichages de formulaire d’une même entité suivant des conditions souhaités:
                            <ul>
                                <li class="fragment">Affichage de widgets différents.</li>
                                <li class="fragment">Affichage de plus ou moins de champs.</li>
                            </ul>
                        </p>
                    </section>
                    <section>
                        <h2>Plusieurs checkout (parcours d'achat)</h2>
                        <ul style="color: #fcc500;">
                            <li class="fragment">Checkout téléchargement de fichier e-book.</li>
                            <li class="fragment">Checkout achat de livre.</li>
                        </ul>
                        <p class="fragment" style="color: #fcc500;">Pour chacun, des étapes et des processus d’achats différents.</p>
                    </section>
                    <section>
                        <h2>Plusieurs checkout</h2>
                        <p>Pour cela:</p>
                        <ul>
                            <li style="color: #fcc500;">Checkout: entité </li>
                            <li class="fragment">Mais aussi:
                                <ul>
                                    <li class="fragment">Plugins pour gérer les volets (pane).</li>
                                    <li class="fragment">Flux de paiement (checkoutFlow).</li>
                                    <li class="fragment">Resolver pour surcharger les règles du flux de paiement.</li>
                                </ul>
                            </li>
                        </ul>
                    </section>
                    <section>
                        <h2>Plusieurs stores (boutiques)</h2>
                        <p class="fragment" style="color: #fcc500;"><i>Exemple: Besoin de faire un store par pays.</i></p>
                        <p class="fragment" style="color: #fcc500;">Store: entité </p>
                        <ul>
                            <li class="fragment">Un store a une devise par défaut.</li>
                            <li class="fragment">Les produits sont assignés à un ou plusieur stores.</li>
                            <li class="fragment">Le store est disponible pour contextualiser checkout, prix etc.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Configuration des paiements intégrée</h2>
                        <p class="fragment" style="color: #fcc500;">Payment: plugin</p>
                        <p class="fragment" style="color: #fcc500;">PaymentMethod: plugin</p>
                        <ul>
                            <li class="fragment">Uniformisation de la configuration des paiements:
                                <ul>
                                    <li class="fragment">Crédentials par environnement développement, validation, production.</li>
                                    <li class="fragment">Méthodes et routes pour les retours du service de paiement.</li>
                                </ul>
                            </li>
                        </ul>
                    </section>
                    <section>
                        <h2>Configuration des paiements intégrée</h2>
                        <ul>
                            <li>Paiement Onsite (intégré au site).</li>
                            <li class="fragment">Paiement Offsite (Redirection vers le service de paiement).</li>
                            <li class="fragment">Méthodes de paiement intégrées au core et surchargeables via plugin.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Price Resolver</h2>
                        <p style="color: #fcc500;" class="fragment">Ex: Réservation d’une chambre, possibilité de calculer le prix dynamiquement à partir du prix de base et en fonction de la période, du nombre de personnes etc.</p>
                        <p class="fragment">Lors de l’affichage ou de l’utilisation d’un prix calculé, possibilité d’ajouter ses propres règles de calcul.</p>
                        <pre class="fragment"><code style="word-wrap: break-word;">
services:
 booking.room_price_resolver:
   class: Drupal\booking\Resolver\RoomPriceResolver
   tags:
     - { name: commerce_price.price_resolver, priority: 0 }
                        </code></pre>
                    </section>
                    <section>
                        <h2>Adjustments &amp; OrderProcessor</h2>
                        <p>Il est possible d’ajouter des modifications à un total de commande ou de ligne de commande.</p>
                        <p style="color: #fcc500;" class="fragment">Les promotions (anciennement discount) sont un exemple d’ajustement proposé par défaut. Ils permettent d’ajouter des plugins configurables par l’utilisateur.</p>
                        <p style="color: #fcc500;" class="fragment">Les taxes sont un autre exemple d'ajustement fourni par le core.</p>
                    </section>
                    <section>
                        <h2>Adjustments &amp; OrderProcessor</h2>
                        <p style="color: #fcc500;" class="fragment">Le module de promotion ajoute un service au transformateur de commande qui lui permet ensuite de sélectionner et appliquer les promotions et ajustements souhaités.</p>
                        <pre class="fragment"><code style="word-wrap: break-word;">
services:
 commerce_promotion.promotion_order_processor:
   class: Drupal\commerce_promotion\PromotionOrderProcessor
   arguments: ['@entity_type.manager']
   tags:
     - { name: commerce_order.order_processor, priority: 50 }
                        </code></pre>
                    </section>
                    <section>
                        <h2>Adjustments &amp; OrderProcessor</h2>
                        <p style="color: #fcc500;" class="fragment">Exemple pour appliquer une réduction de n%.</p>
                        <pre class="fragment"><code style="word-wrap: break-word;">
$order->addAdjustment(new Adjustment([
 'type' => 'promotion',
 'label' => t('Discount'),
 'amount' => $adjustment_amount->multiply('-1'),
 'percentage' => $this->getPercentage(),
 'source_id' => $promotion->id(),
]));
                        </code></pre>
                    </section>
                    <section>
                        <h2>Promotions</h2>
                        <p class="fragment">Promotions (ex discount) et coupons font désormais parties de commerce et sont des plugins facilement étendables.</p>
                        <pre class="fragment"><code style="word-wrap: break-word;">
/**
 * Provides the product condition for order items.
 *
 * @CommerceCondition(
 *   id = "order_item_product",
 *   label = @Translation("Product"),
 *   display_label = @Translation("Limit by product"),
 *   category = @Translation("Product"),
 *   entity_type = "commerce_order_item",
 * )
 */
class OrderItemProduct extends ConditionBase implements ContainerFactoryPluginInterface {}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Promotions</h2>
                        <pre class="fragment"><code style="word-wrap: break-word;">

/**
 * Provides the percentage off offer for orders.
 *
 * @CommercePromotionOffer(
 *   id = "order_external_off",
 *   label = @Translation("Fixed amount off the order total depending of external service"),
 *   entity_type = "commerce_order",
 * )
 */
class OrderExternalOff extends FixedAmountOffBase {
 /**
  * {@inheritdoc}
  */
 public function apply(EntityInterface $entity, PromotionInterface $promotion) {
   $this->assertEntity($entity);
   /** @var \Drupal\commerce_order\Entity\OrderInterface $order */
   $order = $entity;
   $total_price = $order->getTotalPrice();
   $adjustment_amount = $this->getAmount();
   $external_service = \Drupal::service('order.promotion.external.service');
 
   $order->addAdjustment(new Adjustment([
     'type' => 'promotion',
     // @todo Change to label from UI when added in #2770731.
     'label' => t('Discount'),
     'amount' => $external_service->getPromotionAmount($entity),
     'source_id' => $promotion->id(),
   ]));
  }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Migration</h2>
                        <p>Plus besoin de module spécifique pour gérer les migrations de commerce 2.x.</p>
                        <pre class="fragment"><code style="word-wrap: break-word;">
id: import_products
label: 'Import products to Commerce'
source:
  ...
process:
  type:
    plugin: default_value
    default_value: default
  title: title_from_import
  ...
destination:
  plugin: 'entity:commerce_product'
                        </code></pre>
                    </section>
                    <section>
                        <h2>Synchronisation services externes</h2>
                        <ul>
                            <li class="fragment">Entités et plugins peuvent être créés/modifiés via migration.</li>
                            <li class="fragment">Des événements (symfony EventSubscribers) permettent de réagir et d’appeler les services au bon moment.</li>
                            <li class="fragment">Le module REST intégré au core permet une mise en place rapide.</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>En avance sur le core</h2>
                        <ul>
                            <li class="fragment">Gestion des événements plutôt que les hook (adieu les hook!).</li>
                            <li class="fragment">Des tests unitaires et fonctionnels PHPUnit (+ javascript avec mink).</li>
                            <li class="fragment">Utilisation de composer depuis ses débuts.</li>
                        </ul>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Et bien sur</h2>
                        <p>Une équipe disponible et réactive.</p>
                        <p>Une adoption constante avec 2k utilisations depuis sa release en septembre.</p>
                    </section>
                </section>

                <section style="text-align: left;">
                    <h1>Des questions ?</h1>
                    <p>
                        <a href="https://gozoo.github.io/prez-drupal-commerce-2-dclannion">Cette présentation est disponible en ligne sur https://gozoo.github.io/prez-drupal-commerce-2-dclannion</a> <br>
                    </p>
                </section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
